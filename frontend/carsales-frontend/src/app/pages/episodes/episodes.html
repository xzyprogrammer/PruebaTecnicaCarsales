<app-hero-banner></app-hero-banner>

<section class="page-wrap">
  <div class="search-bar">
    <input
      type="text"
      class="search-input"
      placeholder="Buscar por nombre de episodio..."
      [value]="nameFilter()"
      (input)="nameFilter.set(($any($event.target).value || '').toString())"
      (keyup.enter)="applyFilter()"
    />
    <button class="search-btn" (click)="applyFilter()" [disabled]="loading()">Buscar</button>
    <button class="search-btn secondary" (click)="clearFilter()">Limpiar</button>
  </div>

  <div *ngIf="error() as err" class="status status-error">{{ err }}</div>
  <div *ngIf="loading()" class="status status-loading">Cargando episodios...</div>

  <div *ngIf="episodes().length === 0 && !loading()">
    <div class="status">No se encontraron episodios.</div>
  </div>
  <section *ngIf="!loading()" class="episodes-section">
    <div class="episodes-header">
      <h2>Episodios</h2>
      <span class="episodes-meta">
        Página {{ currentPage() }} de {{ totalPages() }} · {{ totalCount() }} episodios
      </span>
    </div>

    <div class="episodes-grid">
      <app-episode-card *ngFor="let ep of episodes();"
        [episode]="ep" (select)="openDetail($event)">
      </app-episode-card>
    </div>
  </section>

  <footer class="pagination">
    <button
      class="page-btn"
      (click)="prevPage()"
      [disabled]="currentPage() <= 1 || loading()"
    >
      Anterior
    </button>
    <span class="page-info">
      Página {{ currentPage() }} de {{ totalPages() }}
    </span>
    <button
      class="page-btn"
      (click)="nextPage()"
      [disabled]="currentPage() >= totalPages() || loading()"
    >
      Siguiente
    </button>
  </footer>
</section>

<app-episode-detail-modal
  [episode]="selectedEpisode()"
  (close)="closeDetail()"
></app-episode-detail-modal>

<div *ngIf="loadingDetail()" class="status status-loading">Cargando detalle del episodio...</div>
<div *ngIf="detailError() as dErr" class="status status-error">{{ dErr }}</div>
